C51 COMPILER V9.54   MAIN                                                                  04/29/2021 09:36:22 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\embeded\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "delay.h"
   3          #include "LCD1602.h"
   4          #include "status.h"
   5          
   6          int el = 0, er = 0, up = 0, down = 0;
   7          
   8          typedef struct Elevator
   9          {
  10              unsigned int index;
  11              unsigned int floor;
  12              unsigned int status;
  13          } Elev;
  14          
  15          Elev leftElev, rightElev;
  16          
  17          void init();
  18          void showElevStatus();
  19          void onButtonClick();
  20          void two2FourDecode(unsigned char flagEl, unsigned char flagEr, unsigned char flagUp, unsigned char flagDo
             -wn);
  21          void showIndicators();
  22          
  23          void main()
  24          {
  25   1          unsigned int k = 0;
  26   1          init();
  27   1          while (1)
  28   1          {
  29   2      
  30   2              onButtonClick();
  31   2              showIndicators();
  32   2      
  33   2              el = 0;
  34   2              er = 0;
  35   2              up = 0;
  36   2              down = 0;
  37   2      
  38   2              for (k = 0; k < 128; k++)
  39   2              {
  40   3                  onButtonClick();
  41   3                  showIndicators();
  42   3              }
  43   2          }
  44   1      }
  45          
  46          void init()
  47          {
  48   1          // 初始化LCD显示屏
  49   1          LCD_Init();
  50   1      
  51   1          // 初始化左边电梯
  52   1          leftElev.index = LEFT;
  53   1          leftElev.floor = 1;
C51 COMPILER V9.54   MAIN                                                                  04/29/2021 09:36:22 PAGE 2   

  54   1          leftElev.status = STILL;
  55   1          // 初始化右边电梯
  56   1          rightElev.index = RIGHT;
  57   1          rightElev.floor = 1;
  58   1          rightElev.status = STILL;
  59   1          showElevStatus();
  60   1      }
  61          
  62          void showElevStatus()
  63          {
  64   1          showStatus(LEFT, leftElev.status, leftElev.floor);
  65   1          showStatus(RIGHT, rightElev.status, rightElev.floor);
  66   1      }
  67          
  68          void onButtonClick()
  69          {
  70   1          if (P1_7)
  71   1          {
  72   2              el |= (1 << ((P1_6 * 4) | (P1_5 * 2) | P1_4));
  73   2          }
  74   1      
  75   1          if (P3_7)
  76   1          {
  77   2              er |= (1 << ((P3_6 * 4) | (P3_5 * 2) | P3_4));
  78   2          }
  79   1      
  80   1          if (P1_3)
  81   1          {
  82   2              up |= (1 << ((P1_2 * 4) | (P1_1 * 2) | P1_0));
  83   2          }
  84   1      
  85   1          if (P3_3)
  86   1          {
  87   2              down |= (1 << ((P3_2 * 4) | (P3_1 * 2) | P3_0));
  88   2          }
  89   1      }
  90          
  91          void two2FourDecode(unsigned char flagEl, unsigned char flagEr, unsigned char flagUp, unsigned char flagDo
             -wn)
  92          {
  93   1          if (flagEl)
  94   1          {
  95   2              P2_3 = 0;
  96   2              P2_4 = 0;
  97   2              P2_5 = 0;
  98   2              delay(1);
  99   2          }
 100   1          if (flagEr)
 101   1          {
 102   2              P2_3 = 1;
 103   2              P2_4 = 0;
 104   2              P2_5 = 0;
 105   2              delay(1);
 106   2          }
 107   1          if (flagUp)
 108   1          {
 109   2              P2_3 = 0;
 110   2              P2_4 = 1;
 111   2              P2_5 = 0;
 112   2              delay(1);
 113   2          }
 114   1          if (flagDown)
C51 COMPILER V9.54   MAIN                                                                  04/29/2021 09:36:22 PAGE 3   

 115   1          {
 116   2              P2_3 = 1;
 117   2              P2_4 = 1;
 118   2              P2_5 = 0;
 119   2              delay(1);
 120   2          }
 121   1          P2_5 = 1;
 122   1      }
 123          
 124          void showIndicators()
 125          {
 126   1          unsigned char i;
 127   1          unsigned char flagEl, flagEr, flagUp, flagDown;
 128   1          for (i = 0; i < 8; i++)
 129   1          {
 130   2              P2_0 = i & 0x01;
 131   2              P2_1 = i & 0x02;
 132   2              P2_2 = i & 0x04;
 133   2              flagEl = (el >> i) & 1 == 1;
 134   2              flagEr = (er >> i) & 1 == 1;
 135   2              flagUp = (up >> i) & 1 == 1;
 136   2              flagDown = (down >> i) & 1 == 1;
 137   2              two2FourDecode(flagEl, flagEr, flagUp, flagDown);
 138   2              delayus(50);
 139   2          }
 140   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    519    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
